<!DOCTYPE html>
<html>
<head>
  <title>Smart Toll Plaza Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; background-color: #f4f4f9; color: #333; text-align: center; }
    h1 { color: #2c3e50; }
    
    .connection-panel { background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: inline-block; margin-bottom: 20px; }
    input[type="text"] { padding: 8px; font-size: 16px; width: 150px; border: 1px solid #ccc; border-radius: 4px; }
    
    .ev-controls { display: flex; justify-content: center; gap: 20px; margin: 20px auto; }
    .ev-button { padding: 15px 25px; color: white; font-size: 16px; font-weight: bold; border: none; border-radius: 50px; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.2); display: flex; align-items: center; gap: 10px; transition: transform 0.1s; }
    
    .btn-l1 { background-color: #2980b9; } 
    .btn-l1:hover { background-color: #3498db; }
    .btn-l2 { background-color: #c0392b; }
    .btn-l2:hover { background-color: #e74c3c; }
    .ev-button:active { transform: scale(0.95); }

    .ev-active-indicator { display: none; font-weight: bold; animation: blink 1s infinite; margin-bottom: 5px; padding: 10px; border-radius: 5px; color: white; }
    .ind-l1 { background-color: #2980b9; }
    .ind-l2 { background-color: #c0392b; }
    @keyframes blink { 50% { opacity: 0.5; } }

    .rates-table { margin: 0 auto 30px auto; border-collapse: collapse; width: 80%; max-width: 600px; background: white; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    .rates-table th, .rates-table td { border: 1px solid #ddd; padding: 12px; }
    .rates-table th { background-color: #2c3e50; color: white; }
    
    .container { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; }
    .lane-card { background: white; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); width: 300px; padding: 20px; border-top: 5px solid #3498db; }
    .lane-2 { border-top: 5px solid #e74c3c; }
    
    h2 { margin-top: 0; }
    .stat-box { background: #ecf0f1; padding: 10px; margin: 10px 0; border-radius: 5px; }
    .stat-label { font-size: 0.9em; color: #7f8c8d; }
    .stat-value { font-size: 1.4em; font-weight: bold; color: #2c3e50; }
    .status-log { font-size: 1em; color: #555; background: #fff; border: 1px solid #ddd; padding: 5px; border-radius: 4px; min-height: 1.2em; font-style: italic;}
    .highlight { color: #27ae60; }
  </style>
</head>
<body>

  <h1>Smart Toll Plaza Monitor</h1>

  <div class="connection-panel">
    <label>ESP32 IP Address: </label>
    <input type="text" id="esp-ip" placeholder="192.168.x.x" value="192.168.1.100">
    <div id="status-msg" style="color:red; margin-top:5px;">Enter IP and wait...</div>
  </div>

  <div class="ev-controls">
    <button class="ev-button btn-l1" onclick="triggerEV(1)">üöë EV ALERT: LANE 1</button>
    <button class="ev-button btn-l2" onclick="triggerEV(2)">üöë EV ALERT: LANE 2</button>
  </div>

  <div id="ev-indicator-1" class="ev-active-indicator ind-l1">‚ö†Ô∏è EV MODE ACTIVE - LANE 1 OPEN ‚ö†Ô∏è</div>
  <div id="ev-indicator-2" class="ev-active-indicator ind-l2">‚ö†Ô∏è EV MODE ACTIVE - LANE 2 OPEN ‚ö†Ô∏è</div>

  <h3>Current Toll Rates</h3>
  <table class="rates-table">
    <tr>
      <th>Vehicle Type</th>
      <th>Height Range</th>
      <th>Fare</th>
    </tr>
    <tr>
      <td>CAR</td>
      <td>3cm - 8.5cm</td>
      <td>5.00 Credits</td>
    </tr>
    <tr>
      <td>TRUCK</td>
      <td>9cm - 20cm</td>
      <td>10.00 Credits</td>
    </tr>
  </table>

  <div class="container">
    <div class="lane-card">
      <h2>LANE 1</h2>
      <div class="stat-box"><div class="stat-label">System Message</div><div class="status-log" id="l1-msg">Waiting...</div></div>
      <div class="stat-box"><div class="stat-label">Queue Count</div><div class="stat-value" id="l1-count">--</div></div>
      <div class="stat-box"><div class="stat-label">Vehicle at Gate</div><div class="stat-value" id="l1-type">--</div></div>
      <div class="stat-box"><div class="stat-label">Required Fare</div><div class="stat-value highlight" id="l1-fare">--</div></div>
      <div class="stat-box"><div class="stat-label">Gate Status</div><div class="stat-value" id="l1-gate">--</div></div>
    </div>

    <div class="lane-card lane-2">
      <h2>LANE 2</h2>
      <div class="stat-box"><div class="stat-label">System Message</div><div class="status-log" id="l2-msg">Waiting...</div></div>
      <div class="stat-box"><div class="stat-label">Queue Count</div><div class="stat-value" id="l2-count">--</div></div>
      <div class="stat-box"><div class="stat-label">Vehicle at Gate</div><div class="stat-value" id="l2-type">--</div></div>
      <div class="stat-box"><div class="stat-label">Required Fare</div><div class="stat-value highlight" id="l2-fare">--</div></div>
      <div class="stat-box"><div class="stat-label">Gate Status</div><div class="stat-value" id="l2-gate">--</div></div>
    </div>
  </div>

<script>
  function triggerEV(laneNumber) {
    const ip = document.getElementById('esp-ip').value;
    if(ip.length < 7) { alert("Please enter ESP32 IP first"); return; }
    
    fetch(‚Å†‚ÄØhttp://${ip}/set_ev?lane=${laneNumber}‚ÄØ‚Å†)
      .then(response => { if(response.ok) alert(‚Å†‚ÄØEV Alert Sent to Lane ${laneNumber}! Gate opening...‚ÄØ‚Å†); })
      .catch(e => alert("Connection Failed"));
  }

  function updateDashboard(data) {
    document.getElementById('status-msg').innerText = "Connected";
    document.getElementById('status-msg').style.color = "green";

    document.getElementById('ev-indicator-1').style.display = data.ev_mode_l1 ? 'block' : 'none';
    document.getElementById('ev-indicator-2').style.display = data.ev_mode_l2 ? 'block' : 'none';

    // Lane 1
    document.getElementById('l1-count').innerText = data.l1_count;
    document.getElementById('l1-type').innerText = data.l1_type;
    document.getElementById('l1-fare').innerText = data.l1_fare.toFixed(2);
    document.getElementById('l1-msg').innerText = data.l1_msg;
    const l1Gate = document.getElementById('l1-gate');
    l1Gate.innerText = data.l1_gate ? "OPEN" : "CLOSED";
    l1Gate.style.color = data.l1_gate ? "#27ae60" : "#c0392b";

    // Lane 2
    document.getElementById('l2-count').innerText = data.l2_count;
    document.getElementById('l2-type').innerText = data.l2_type;
    document.getElementById('l2-fare').innerText = data.l2_fare.toFixed(2);
    document.getElementById('l2-msg').innerText = data.l2_msg;
    const l2Gate = document.getElementById('l2-gate');
    l2Gate.innerText = data.l2_gate ? "OPEN" : "CLOSED";
    l2Gate.style.color = data.l2_gate ? "#27ae60" : "#c0392b";
  }

  setInterval(function() {
    const ip = document.getElementById('esp-ip').value;
    if(ip.length < 7) return; 

    fetch(‚Å†‚ÄØhttp://${ip}/data‚ÄØ‚Å†)
      .then(response => { if (!response.ok) throw new Error("Err"); return response.json(); })
      .then(data => updateDashboard(data))
      .catch(error => { document.getElementById('status-msg').innerText = "Connecting..."; document.getElementById('status-msg').style.color = "orange"; });
  }, 1000);
</script>

</body>
</html>
